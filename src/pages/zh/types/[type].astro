---
import Layout from "../../../layouts/Layout.astro";
import personalityTypesDataZh from "../../../data/zh/personality-types.json";
import { getLangFromUrl, useTranslations } from "../../../i18n/ui";
import Footer from "../../../components/Footer.astro";
import ShareButtons from "../../../components/ShareButtons.tsx";

export async function getStaticPaths() {
  const types = Object.keys(personalityTypesDataZh.types);
  console.log(types);
  return types.map((type) => ({
    params: { type: type },
  }));
}

const { type } = Astro.params;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Load personality types data based on language
const personalityTypesData = lang === 'en' 
  ? await import("../../../data/en/personality-types.json")
  : personalityTypesDataZh;

const personalityType =
  personalityTypesData.types[type as keyof typeof personalityTypesData.types];

if (!personalityType) {
  return Astro.redirect("/404");
}
---

<Layout>
  <div class="min-h-screen bg-flexoki-paper">
 
    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-8 py-16">
      <!-- Hero Section -->
      <div class="mb-8">
        <div class="text-8xl mb-8 text-flexoki-black tracking-wider">
          {type}
        </div>
        <h1 class="text-2xl mb-4 text-flexoki-base-700">
          {personalityType.name}
        </h1>
        <p class="text-base text-flexoki-base-700 leading-loose">
          {personalityType.description}
        </p>
      </div>

      <!-- Traits Section -->
      <section class="mb-8">
        <h2
          class="text-sm text-flexoki-base-500/60 font-bold mb-2 tracking-widest uppercase"
        >
          {t('type.coreTraits')}
        </h2>
        <div class="space-y-3 flex gap-3">
          {
            personalityType.traits.map((trait: string) => (
              <span class="text-flexoki-base-800">{trait}</span>
            ))
          }
        </div>
      </section>

      <!-- Strengths and Challenges -->
      <div class="grid md:grid-cols-2 gap-16 mb-20">
        <!-- Strengths -->
        <section class="">
          <h2
            class="text-sm text-flexoki-base-500/60 font-bold mb-2 tracking-widest uppercase"
          >
            {t('type.strengths')}
          </h2>
          <div class="space-y-3">
            {
              personalityType.strengths.map((strength: string) => (
                <div class="text-flexoki-base-700 leading-relaxed pl-4 border-l-2 border-flexoki-green-200 bg-flexoki-green-50/30 py-2 pr-3 rounded-r">
                  {strength}
                </div>
              ))
            }
          </div>
        </section>

        <!-- Challenges -->
        <section>
          <h2
            class="text-sm text-flexoki-base-500/60 font-bold mb-2 tracking-widest uppercase"
          >
            {t('type.challenges')}
          </h2>
          <div class="space-y-3">
            {
              personalityType.challenges.map((challenge: string) => (
                <div class="text-flexoki-base-700 leading-relaxed pl-4 border-l-2 border-flexoki-orange-200 bg-flexoki-orange-50/30 py-2 pr-3 rounded-r">
                  {challenge}
                </div>
              ))
            }
          </div>
        </section>
      </div>

      <!-- Share Buttons -->
      <div class="mt-12 pt-8">
        <ShareButtons
          lang={lang}
          personalityType={type}
          personalityName={personalityType.name}
          client:load
        />
      </div>

      <!-- Action Buttons -->
      <div class="text-center space-y-8 mt-24">
        <a
          href="/zh/quiz"
          class="inline-flex text-flexoki-base-600 hover:text-flexoki-base-800 text-sm tracking-wide uppercase border-b border-flexoki-base-300 pb-1"
        >
          {t('type.retakeQuiz')}
        </a>
      </div>
    </main>

    <!-- Footer -->
    <Footer />
  </div>

  <script>
    function copyToClipboard(text: string) {
      navigator.clipboard
        .writeText(text)
        .then(() => {
          alert("链接已复制到剪贴板！");
        })
        .catch(() => {
          alert("复制失败，请手动复制链接");
        });
    }
  </script>
</Layout>
